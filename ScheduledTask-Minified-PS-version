powershell -command "$ErrorActionPreference='SILENTLYCONTINUE';del \"%TEMP%\\log4j1.log\";del \"%TEMP%\\log4j2.log\";del \"%TEMP%\\log4j3.log\";get-wmiobject win32_volume|? {$_.DriveType-eq3}|% {(Get-Psdrive  $_.DriveLetter[0]).Name}|Foreach {$command='findstr /i /s /m \"SocketServer.class JndiLookup.class\" {0}:\*.jar >> \"%TEMP%\\log4j1.log\" | findstr /i /s /m \"SocketServer.class JndiLookup.class\" {0}:\*.war >> \"%TEMP%\\log4j2.log\"| findstr /i /s /m \"SocketServer.class JndiLookup.class\" {0}:\*log4j*.dll  >> \"%TEMP%\\log4j3.log\"'-f$_;cmd /c $command};$jar=Get-Content -Path ($Env:TEMP + '\\log4j1.log');$war=Get-Content -Path ($Env:TEMP + '\\log4j2.log');$dll=Get-Content -Path ($Env:TEMP + '\\log4j3.log');class GraylogMessage {[string] $short_message;[string] $full_message; [string] $source};if(($jar+$zip+$dll)-ne''){$Uri='http://10.3.20.46:12201/gelf';$Headers=@{'Content-Type'='application/json'};$Message=[GraylogMessage]::New();$Message.source=$Env:computername;$Message.short_message='log4j Found';$Message.full_message=($jar+$war+$dll);Invoke-WebRequest -Uri $Uri -Method POST -Headers $Headers -Body (ConvertTo-Json $Message)}else{$Uri='http://{GRAYLOGIP:PORTNUMBER}/gelf';$Headers=@{'Content-Type'='application/json'};$Message=[GraylogMessage]::New();$Message.source=$Env:computername;$Message.short_message='log4j Not Found';$Message.full_message=($jar+$war+$dll);Invoke-WebRequest -Uri $Uri -Method POST -Headers $Headers -Body (ConvertTo-Json $Message)}"
